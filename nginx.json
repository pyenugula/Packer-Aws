{
    "variables": {
        "aws_access_key": "{{env `AWS_ACCESS_KEY`}}",
        "aws_secret_key": "{{env `AWS_SECRET_KEY`}}",
        "aws_region": "{{env `AWS_REGION` }}"
    },
    
    "builders" :[{
            "type":"amazon-ebs",
            "access_key": "{{user `aws_access_key`}}",
            "secret_key": "{{user `aws_secret_key`}}",
            "region": "{{user `aws_region`}}",
            "security_group_id": "sg-0d95988dabc694333",
            "source_ami_filter": {
                "filters": {
                    "virtualization-type": "hvm",
                    "root-device-type":"ebs",
                    "name": "ubuntu-pro-server/images/hvm-ssd/*ubuntu-bionic-18.04-amd64-pro-server-*"
                },
                "owners" : ["099720109477"],
                "most_recent" :true
            },
            "instance_type": "t2.micro",
            "ssh_username": "ubuntu",
            "ami_name": "nginx {{timestamp}}",
            "tags"  : {
                "Name": "nginx-server"
            }
        }],

        "provisioners": [
            {
                "type": "ansible",
                "playbook_file": "nginx.yml",
                "user": "ubuntu",
                "extra_arguments": [ "--extra-vars", "ansible_python_interpreter=/usr/bin/python3" ]
            }
        ],
        
        "post-processors": [
            {
                "type": "manifest",
                "output": "manifest.json",
                "strip_path": true
            }
        ]
            
}
